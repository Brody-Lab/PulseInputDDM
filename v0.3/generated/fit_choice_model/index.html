<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Loading data and fitting a choice model · pulse input DDM</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><nav class="toc"><a href="../../"><img class="logo" src="../../assets/logo.png" alt="pulse input DDM logo"/></a><h1>pulse input DDM</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><span class="toctext">Home</span><ul><li><a class="toctext" href="../../">pulse input DDM</a></li></ul></li><li><span class="toctext">Basics</span><ul><li><a class="toctext" href="../../man/getting_the_package/">Downloading the package</a></li><li class="current"><a class="toctext" href>Loading data and fitting a choice model</a><ul class="internal"><li><a class="toctext" href="#Fitting-the-model-1">Fitting the model</a></li></ul></li><li><a class="toctext" href="../recover_choice_model/">Fitting a choice model</a></li><li><a class="toctext" href="../recover_neural_model/">Fitting a neural model</a></li></ul></li><li><span class="toctext">Other helpful info</span><ul><li><a class="toctext" href="../../man/vpn_is_annoying/">Efficient Remote SSH</a></li></ul></li><li><span class="toctext">Development</span><ul><li><a class="toctext" href="../../man/development/">Developing the code</a></li></ul></li><li><span class="toctext">Index</span><ul><li><a class="toctext" href="../../links/">Index</a></li></ul></li><li><span class="toctext">Functions</span><ul><li><a class="toctext" href="../../functions/">Functions</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Basics</li><li><a href>Loading data and fitting a choice model</a></li></ul><a class="edit-page" href="https://github.com/Brody-Lab/pulse_input_DDM/blob/master/examples/choice model/fit_choice_model.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Loading data and fitting a choice model</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Loading-data-and-fitting-a-choice-model-1" href="#Loading-data-and-fitting-a-choice-model-1">Loading data and fitting a choice model</a></h1><p>The package expects your data to live in a single .mat file which should contain a struct called <code>rawdata</code>. Each element of <code>rawdata</code> should have data for one behavioral trial and <code>rawdata</code> should contain the following fields with the specified structure:</p><ul><li><code>rawdata.leftbups</code>: row-vector containing the relative timing, in seconds, of left clicks on an individual trial. 0 seconds is the start of the click stimulus.</li><li><code>rawdata.rightbups</code>: row-vector containing the relative timing in seconds (origin at 0 sec) of right clicks on an individual trial. 0 seconds is the start of the click stimulus.</li><li><code>rawdata.T</code>: the duration of the trial, in seconds. The beginning of a trial is defined as the start of the click stimulus. The end of a trial is defined based on the behavioral event “cpoke_end”. This was the Hanks convention.</li><li><code>rawdata.pokedR</code>: <code>Bool</code> representing the animal choice (1 = right).</li></ul><h2><a class="nav-anchor" id="Fitting-the-model-1" href="#Fitting-the-model-1">Fitting the model</a></h2><p>Once your data is correctly formatted and you have the package added in julia, you are ready to fit the model. You need to write a slurm script to use spock&#39;s resources and a .jl file to load the data and fit the model. See examples of each below. These files are also located in the package in the <code>examples</code> directory.</p><h3><a class="nav-anchor" id="Example-slurm-script-1" href="#Example-slurm-script-1">Example slurm script</a></h3><p>This will start a job called <code>fit_choice_model</code>. Output will be written to a log file called <code>fit_choice_model.out</code>. This will run on the <code>Brody</code> partition of spock for 12 hours, using 44 cores and 64 GB of memory. You&#39;ll notice that we load the julia module (like we did when we added the package) and then we call julia (<code>-p 44</code> uses the 44 cores) and ask it to run the .jl file.</p><pre><code class="language-none">#!/usr/bin/env bash

#SBATCH -J &#39;fit_choice_model&#39;
#SBATCH -o ../logs/fit_choice_model.out
#SBATCH -p Brody
#SBATCH --time=12:00:00
#SBATCH --mem=64000
#SBATCH -c 44

module load julia/1.0.0
julia -p 44 ./fit_choice_model.jl</code></pre><h3><a class="nav-anchor" id="Example-.jl-file-1" href="#Example-.jl-file-1">Example .jl file</a></h3><p>Blah blah blah</p><pre><code class="language-julia">using pulse_input_DDM</code></pre><h3><a class="nav-anchor" id="Load-some-data-1" href="#Load-some-data-1">Load some data</a></h3><p>Blah blah blah</p><pre><code class="language-">data = load(&quot;../examples/choice model/example_matfile.mat&quot;)</code></pre><h3><a class="nav-anchor" id="Set-options-for-optimization-1" href="#Set-options-for-optimization-1">Set options for optimization</a></h3><p>Blah blah blah</p><pre><code class="language-julia">n = 53

options = choiceoptions(fit = vcat(trues(9)),
    lb = vcat([0., 8., -5., 0., 0., 0.01, 0.005], [-30, 0.]),
    ub = vcat([2., 30., 5., 100., 2.5, 1.2, 1.], [30, 1.]),
    x0 = vcat([0.1, 15., -0.1, 20., 0.5, 0.8, 0.008], [0.,0.01]))</code></pre><pre><code class="language-none">choiceoptions
  fit: Array{Bool}((9,)) Bool[1, 1, 1, 1, 1, 1, 1, 1, 1]
  lb: Array{Float64}((9,)) [0.0, 8.0, -5.0, 0.0, 0.0, 0.01, 0.005, -30.0, 0.0]
  ub: Array{Float64}((9,)) [2.0, 30.0, 5.0, 100.0, 2.5, 1.2, 1.0, 30.0, 1.0]
  x0: Array{Float64}((9,)) [0.1, 15.0, -0.1, 20.0, 0.5, 0.8, 0.008, 0.0, 0.01]
</code></pre><h3><a class="nav-anchor" id="Load-some-data-2" href="#Load-some-data-2">Load some data</a></h3><p>Blah blah blah</p><pre><code class="language-julia">save_file = &quot;../examples/choice model/example_results.mat&quot;

#if you&#39;ve already ran the optimization once and want to restart from where you stoped, this will reload those parameters
if isfile(save_file)
    options.x0 = reload(save_file)
end</code></pre><h3><a class="nav-anchor" id="Optimize-stuff-1" href="#Optimize-stuff-1">Optimize stuff</a></h3><p>Blah blah blah</p><pre><code class="language-">model, = optimize(data, options, n; iterations=5, outer_iterations=1)</code></pre><h3><a class="nav-anchor" id="Compute-Hessian-and-the-confidence-interavls-1" href="#Compute-Hessian-and-the-confidence-interavls-1">Compute Hessian and the confidence interavls</a></h3><p>Blah blah blah</p><pre><code class="language-">H = Hessian(model, n)
CI, HPSD = CIs(H);
nothing #hide</code></pre><h3><a class="nav-anchor" id="Save-results-1" href="#Save-results-1">Save results</a></h3><p>Blah blah blah</p><pre><code class="language-">save(save_file, model, options, CI)</code></pre><h3><a class="nav-anchor" id="Getting-help-1" href="#Getting-help-1">Getting help</a></h3><p>To get more details about how any function in this package works, in julia you can type <code>?</code> and then the name of the function. Documentation will display in the REPL.</p><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../../man/getting_the_package/"><span class="direction">Previous</span><span class="title">Downloading the package</span></a><a class="next" href="../recover_choice_model/"><span class="direction">Next</span><span class="title">Fitting a choice model</span></a></footer></article></body></html>
