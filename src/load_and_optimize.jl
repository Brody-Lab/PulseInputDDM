path = ARGS[1]
@everywhere using Pkg
@everywhere Pkg.activate("/mnt/bucket/people/briandd/Projects/pulse_input_DDM.jl")
@everywhere using pulse_input_DDM
using JLD

data_path = path*"/data/hanks_data_sessions"
region = "FOF"

if region == "FOF"
    
    ratnames = ["B068","T034","T036","T063","T030"]
    sessids = vcat([[46331,46484,46630,47745,48117,48988,49313,49380,49545,49819,50353,50838,50951,51621,51852,52307]],
            [[151801,152157,152272,152370,152509,152967,153253,153859,154807,154949,
                157482,161543,163862,163993,164420,164573,165023,168608,169683]],
            [[154154,154291,154448,154991,155124,155247,155840,157201,157357,157507,168499,168627]],
            [[191956,193936,194554,194649,194770,194898,195271,195546,195676,195791,196336,196580,
                196708,197075,197212,197479,198004]],
            [[151411]])
    
elseif region == "PPC"
    
    ratnames = ["T035","T011","B053"]
    sessids = vcat([[152177,153274,153536,154288,154440,155839,156150,156443,156896,
            157200,157359,161394,162142, 162258,163098,163885,164449,164604,164752,164900,165058,166135,
            166590,167725,167855,167993,168132,168628,169448,169736,169873,169993]],
        [[153219,153382,153510,154806,154950,155375,155816,155954,157026,157178,
            157483,158231,161057,161351,164574,165972]],
        [[51344, 52162,52425, 53154,54377]])
    
elseif region == "STR"
    
    ratnames = ["T080","T103","E021"]
    sessids = vcat([[297609,302840,300465,298403,301749,300634,301314]],
            [[305643,298428,300658,294987,309283,306371,302671,308388,304258,
                310429,301336,299423,305431,309785,
                295550,296097,309417,307162,308051,298331,304450,
                303075,305822,305189,299015,297945,306747,310643,300487,
                310245,298622,307847,302877,295883,294779,306964,295658]],
            [[318132,320452,320240,322668,321215,321411,322326,321705,
                323936,328460,317734,320077,322887,322475,
                323781,323420,321019,323619]])
    
end

pz, pd = load_and_optimize(data_path,sessids,ratnames)

save_path = path*"/data/results"
mkpath(save_path)
@save save_path*"/"*region*"_fit_results.jld"
